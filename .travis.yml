sudo: false
language: php
php:
#  - 5.3
  - 5.4
  - 5.5
  - 5.6
  - 7.0
  - nightly
matrix:
  allow_failures:
    - php: nightly
services:
  - memcached
  - redis-server
env: ACTIVESYNC_SQL_MYSQL_TEST_CONFIG='{"activesync":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' ACTIVESYNC_SQL_MYSQLI_TEST_CONFIG='{"activesync":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' ACTIVESYNC_SQL_PDO_MYSQL_TEST_CONFIG='{"activesync":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' ALARM_TEST_CONFIG='{"alarm":{"test":{"horde":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' CRYPT_TEST_CONFIG='{"crypt":{"keyserver":false}}' DB_ADAPTER_MYSQL_TEST_CONFIG='{"db":{"adapter":{"mysql":{"test":{"host":"localhost","username":"root","password":"","dbname":"test"}}}}}' DB_ADAPTER_MYSQLI_TEST_CONFIG='{"db":{"adapter":{"mysqli":{"test":{"host":"localhost","username":"root","password":"","dbname":"test"}}}}}' DB_ADAPTER_PDO_MYSQL_TEST_CONFIG='{"db":{"adapter":{"pdo":{"mysql":{"test":{"host":"localhost","username":"root","password":"","dbname":"test"}}}}}}' DB_ADAPTER_PDO_PGSQL_TEST_CONFIG='{"db":{"adapter":{"pdo":{"pgsql":{"test":{"username":"postgres","password":"","dbname":"test"}}}}}}' GROUP_SQL_MYSQL_TEST_CONFIG='{"group":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' GROUP_SQL_MYSQLI_TEST_CONFIG='{"group":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' GROUP_SQL_PDO_MYSQL_TEST_CONFIG='{"group":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' GROUP_SQL_PDO_PGSQL_TEST_CONFIG='{"group":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}' HASHTABLE_MEMCACHE_TEST_CONFIG='{"hashtable":{"memcache":{"hostspec":["localhost"],"port":[11211]}}}' HASHTABLE_PREDIS_TEST_CONFIG='{"hashtable":{"predis":{"hostspec":["localhost"],"scheme":"tcp"}}}' HISTORY_MONGO_TEST_CONFIG='{"history":{"mongo":"mongodb://localhost"}}' HISTORY_SQL_MYSQL_TEST_CONFIG='{"history":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' HISTORY_SQL_MYSQLI_TEST_CONFIG='{"history":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' HISTORY_SQL_PDO_MYSQL_TEST_CONFIG='{"history":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' HISTORY_SQL_PDO_PGSQL_TEST_CONFIG='{"history":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}' HTTP_TEST_CONFIG='{"http":{"server":"www.google.com"}}' IMAGE_EXIF_TEST_CONFIG='{"image":{"exiftool":"/usr/bin/exiftool"}}' IMAPCLIENT_TEST_CONFIG='{"imapclient":{"mongo":"localhost"}}' MAILAUTOCONFIG_TEST_CONFIG='{"mail_autoconfig":{"nonauth_emails":["test@gmail.com","test@gmx.net"],"nonauth_emails_bad":["test@example.com"],"domains":[[["gmail.com"]],[["test.mail.gmail.com","mail.gmail.com","gmail.com"]]]}}' LDAP_TEST_CONFIG='a:2:{s:6:"server";a:5:{s:8:"hostspec";s:9:"localhost";s:4:"port";i:3389;s:6:"basedn";s:23:"ou=Test,dc=horde,dc=org";s:6:"binddn";s:24:"cn=admin,dc=horde,dc=org";s:6:"bindpw";s:4:"test";}s:10:"capability";a:2:{s:9:"anonymous";b:1;s:3:"tls";b:1;}}' LOCK_MONGO_TEST_CONFIG='{"lock":{"mongo":"localhost"}}' PEAR_TEST_CONFIG='{"pear":{"config":"/etc/pear/pear.conf","server":"pear.horde.org"}}' PREFS_SQL_MYSQL_TEST_CONFIG='{"prefs":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' PREFS_SQL_MYSQLI_TEST_CONFIG='{"prefs":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' PREFS_SQL_PDO_MYSQL_TEST_CONFIG='{"prefs":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' PREFS_SQL_PDO_PGSQL_TEST_CONFIG='{"prefs":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}' SERVICE_GRAVATAR_TEST_CONFIG='{"service":{"gravatar":{"server":"http://www.gravatar.com"}}}' SESSIONHANDLER_SQL_MYSQL_TEST_CONFIG='{"sessionhandler":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SESSIONHANDLER_SQL_MYSQLI_TEST_CONFIG='{"sessionhandler":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SESSIONHANDLER_SQL_PDO_MYSQL_TEST_CONFIG='{"sessionhandler":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SESSIONHANDLER_SQL_PDO_PGSQL_TEST_CONFIG='{"sessionhandler":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}' SHARE_SQL_MYSQL_TEST_CONFIG='{"share":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SHARE_SQL_MYSQLI_TEST_CONFIG='{"share":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SHARE_SQL_PDO_MYSQL_TEST_CONFIG='{"share":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SHARE_SQL_PDO_PGSQL_TEST_CONFIG='{"share":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}' TOKEN_MONGO_TEST_CONFIG='{"token":{"mongo":"localhost"}}' VCS_TEST_CONFIG='{"paths":{"ci":"\/usr\/bin\/ci","co":"\/usr\/bin\/co","rcs":"\/usr\/bin\/rcs","rcsdiff":"\/usr\/bin\/rcsdiff","rlog":"\/usr\/bin\/rlog","cvs":"\/usr\/bin\/cvs","cvsps":"\/usr\/bin\/cvsps","cvsps_home":"\/tmp","svn":"\/usr\/bin\/svn","diff":"\/usr\/bin\/diff","git":"\/usr\/bin\/git"}}' VFS_MONGO_TEST_CONFIG='{"vfs":{"mongo":{"hostspec":"localhost"}}}' VFS_SQL_MYSQL_TEST_CONFIG='{"vfs":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' VFS_SQL_MYSQLI_TEST_CONFIG='{"vfs":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' VFS_SQL_PDO_MYSQL_TEST_CONFIG='{"vfs":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' VFS_SQL_PDO_PGSQL_TEST_CONFIG='{"vfs":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}'
addons:
  apt:
    packages:
    - aspell
    - aspell-en
    - cvs
    - cvsps
    - language-pack-en
    - language-pack-cs
    - language-pack-de
    - language-pack-tr
    - ldap-utils
    - libimage-exiftool-perl
    - libwbxml2-utils
    - rcs
    - slapd
before_install:
  - mysql -e "create database IF NOT EXISTS test;" -uroot
before_script:
  - phpenv config-add .travis.ini
  - pear install channel://pear.php.net/Net_DNS2
  - pear install channel://pear.horde.org/Horde_Role
  - ./framework/bin/pear_batch_install
  - psql -c 'create database test;' -U postgres
  - ldapadd -Y EXTERNAL -H ldapi:/// -f framework/Ldap/test/Horde/Ldap/fixtures/db.ldif
  - ldapadd -D cn=admin,dc=horde,dc=org -w test -f framework/Ldap/test/Horde/Ldap/fixtures/base.ldif
script: ./framework/bin/test_framework
