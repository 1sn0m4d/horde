language: php
php:
#  - 5.3
  - 5.4
  - 5.5
  - 5.6
  - hhvm
env:
  - TESTDIR=framework/ActiveSync/test/Horde/ActiveSync ACTIVESYNC_SQL_MYSQL_TEST_CONFIG='{"activesync":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' ACTIVESYNC_SQL_MYSQLI_TEST_CONFIG='{"activesync":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' ACTIVESYNC_SQL_PDO_MYSQL_TEST_CONFIG='{"activesync":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}'
  - TESTDIR=framework/Alarm/test/Horde/Alarm ALARM_TEST_CONFIG='{"alarm":{"test":{"horde":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}'
  - TESTDIR=framework/Crypt/test/Horde/Crypt CRYPT_TEST_CONFIG='{"crypt":{"keyserver":false}}'
  - TESTDIR=framework/Db/test/Horde/Db DB_ADAPTER_MYSQL_TEST_CONFIG='{"db":{"adapter":{"mysql":{"test":{"host":"localhost","username":"root","password":"","dbname":"test"}}}}}' DB_ADAPTER_MYSQLI_TEST_CONFIG='{"db":{"adapter":{"mysqli":{"test":{"host":"localhost","username":"root","password":"","dbname":"test"}}}}}' DB_ADAPTER_PDO_MYSQL_TEST_CONFIG='{"db":{"adapter":{"pdo":{"mysql":{"test":{"host":"localhost","username":"root","password":"","dbname":"test"}}}}}}' DB_ADAPTER_PDO_PGSQL_TEST_CONFIG='{"db":{"adapter":{"pdo":{"pgsql":{"test":{"username":"postgres","password":"","dbname":"test"}}}}}}'
  - TESTDIR=framework/Group/test/Horde/Group GROUP_SQL_MYSQL_TEST_CONFIG='{"group":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' GROUP_SQL_MYSQLI_TEST_CONFIG='{"group":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' GROUP_SQL_PDO_MYSQL_TEST_CONFIG='{"group":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' GROUP_SQL_PDO_PGSQL_TEST_CONFIG='{"group":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}'
  - TESTDIR=framework/History/test/Horde/History HISTORY_MONGO_TEST_CONFIG='{"history":{"mongo":"mongodb://localhost"}}' HISTORY_SQL_MYSQL_TEST_CONFIG='{"history":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' HISTORY_SQL_MYSQLI_TEST_CONFIG='{"history":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' HISTORY_SQL_PDO_MYSQL_TEST_CONFIG='{"history":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' HISTORY_SQL_PDO_PGSQL_TEST_CONFIG='{"history":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}'
  - TESTDIR=framework/Http/test/Horde/Http HTTP_TEST_CONFIG='{"http":{"server":"www.google.com"}}'
  - TESTDIR=framework/Image/test/Horde/Image IMAGE_EXIF_TEST_CONFIG='{"image":{"exiftool":"/usr/bin/exiftool"}}'
  - TESTDIR=framework/Imap_Client/test/Horde/Imap/Client IMAPCLIENT_TEST_CONFIG='{"imapclient":{"mongo":"localhost"}}'
  - TESTDIR=framework/Mail_Autoconfig/test/Horde/Mail/Autoconfig MAILAUTOCONFIG_TEST_CONFIG='{"mail_autoconfig":{"nonauth_emails":["test@gmail.com","test@gmx.net"],"nonauth_emails_bad":["test@example.com"],"domains":[[["gmail.com"]],[["test.mail.gmail.com","mail.gmail.com","gmail.com"]]]}}'
  - TESTDIR=framework/Lock/test/Horde/Lock LOCK_MONGO_TEST_CONFIG='{"lock":{"mongo":"localhost"}}'
  - TESTDIR=framework/Pear/test/Horde/Pear PEAR_TEST_CONFIG='{"pear":{"config":"/etc/pear/pear.conf","server":"pear.horde.org"}}'
  - TESTDIR=framework/Prefs/test/Horde/Prefs PREFS_SQL_MYSQL_TEST_CONFIG='{"prefs":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' PREFS_SQL_MYSQLI_TEST_CONFIG='{"prefs":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' PREFS_SQL_PDO_MYSQL_TEST_CONFIG='{"prefs":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' PREFS_SQL_PDO_PGSQL_TEST_CONFIG='{"prefs":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}'
  - TESTDIR=framework/Service_Gravatar/test/Horde/Service/Gravatar SERVICE_GRAVATAR_TEST_CONFIG='{"service":{"gravatar":{"server":"http://www.gravatar.com"}}}'
  - TESTDIR=framework/SessionHandler/test/Horde/SessionHandler SESSIONHANDLER_SQL_MYSQL_TEST_CONFIG='{"sessionhandler":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SESSIONHANDLER_SQL_MYSQLI_TEST_CONFIG='{"sessionhandler":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SESSIONHANDLER_SQL_PDO_MYSQL_TEST_CONFIG='{"sessionhandler":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SESSIONHANDLER_SQL_PDO_PGSQL_TEST_CONFIG='{"sessionhandler":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}'
  - TESTDIR=framework/Share/test/Horde/Share SHARE_SQL_MYSQL_TEST_CONFIG='{"share":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SHARE_SQL_MYSQLI_TEST_CONFIG='{"share":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SHARE_SQL_PDO_MYSQL_TEST_CONFIG='{"share":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' SHARE_SQL_PDO_PGSQL_TEST_CONFIG='{"share":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}'
  - TESTDIR=framework/Token/test/Horde/Token TOKEN_MONGO_TEST_CONFIG='{"token":{"mongo":"localhost"}}'
  - TESTDIR=framework/Vcs/test/Horde/Vcs VCS_TEST_CONFIG='{"paths":{"ci":"\/usr\/bin\/ci","co":"\/usr\/bin\/co","rcs":"\/usr\/bin\/rcs","rcsdiff":"\/usr\/bin\/rcsdiff","rlog":"\/usr\/bin\/rlog","cvs":"\/usr\/bin\/cvs","cvsps":"\/usr\/bin\/cvsps","cvsps_home":"\/tmp","svn":"\/usr\/bin\/svn","diff":"\/usr\/bin\/diff","git":"\/usr\/bin\/git"}}'
  - TESTDIR=framework/Vfs/test/Horde/Vfs VFS_MONGO_TEST_CONFIG='{"vfs":{"mongo":{"hostspec":"localhost"}}}' VFS_SQL_MYSQL_TEST_CONFIG='{"vfs":{"sql":{"mysql":{"adapter":"mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' VFS_SQL_MYSQLI_TEST_CONFIG='{"vfs":{"sql":{"mysqli":{"adapter":"mysqli","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' VFS_SQL_PDO_MYSQL_TEST_CONFIG='{"vfs":{"sql":{"pdo_mysql":{"adapter":"pdo_mysql","host":"localhost","username":"root","password":"","dbname":"test","charset":"utf-8"}}}}' VFS_SQL_PDO_PGSQL_TEST_CONFIG='{"vfs":{"sql":{"pdo_pgsql":{"adapter":"pdo_pgsql","username":"postgres","password":"","dbname":"test","charset":"utf-8"}}}}'
matrix:
  allow_failures:
    - php: hhvm
before_install:
  - sudo locale-gen cs_CZ.UTF-8 de_DE.UTF-8 tr_TR
  - sudo apt-get -qq install libwbxml2-utils aspell rcs cvs cvsps libimage-exiftool-perl
before_script:
  - echo "extension = memcache.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - echo "extension = mongo.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - pear install channel://pear.php.net/Net_DNS2
  - pear install channel://pear.horde.org/Horde_Role
  - ./framework/bin/pear_batch_install
  - psql -c 'create database test;' -U postgres
script: cd $TESTDIR && phpunit -v .
